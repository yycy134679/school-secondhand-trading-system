# 需求文档

## 简介

本功能旨在改进现有的"为你推荐"系统，从基于标签的推荐算法改为基于商品分类的推荐算法。新的推荐逻辑将根据用户最近浏览的商品分类来推荐相关商品，提供更精准和多样化的推荐结果。

## 术语表

- **推荐系统（Recommendation System）**: 根据用户行为历史为用户推荐相关商品的系统
- **浏览记录（View Record）**: 用户查看商品详情的历史记录
- **商品分类（Category）**: 商品所属的类别，如"数码电子"、"图书教材"等
- **在售商品（ForSale Product）**: 状态为"ForSale"的可购买商品
- **推荐列表（Recommendation List）**: 系统为用户生成的推荐商品集合

## 需求

### 需求 1

**用户故事：** 作为一个已登录的用户，我希望看到基于我最近浏览分类的推荐商品，以便我能发现更多我感兴趣的商品。

#### 验收标准

1. WHEN 用户有浏览记录 THEN 推荐系统 SHALL 提取用户最近浏览的商品的分类信息
2. WHEN 用户最近浏览了多个不同分类的商品 THEN 推荐系统 SHALL 选择最新浏览的两个不同分类
3. WHEN 用户只浏览了一个分类的商品 THEN 推荐系统 SHALL 仅基于该单一分类进行推荐
4. WHEN 用户没有浏览记录 THEN 推荐系统 SHALL 返回空的推荐列表
5. WHEN 推荐系统选定了分类 THEN 推荐系统 SHALL 排除用户自己发布的商品

### 需求 2

**用户故事：** 作为一个用户，我希望推荐列表展示固定数量的商品，以便获得清晰一致的浏览体验。

#### 验收标准

1. WHEN 推荐系统生成推荐列表 THEN 推荐系统 SHALL 返回最多4件商品
2. WHEN 推荐系统基于两个分类推荐 THEN 推荐系统 SHALL 从每个分类各推荐2件商品
3. WHEN 推荐系统基于单一分类推荐 THEN 推荐系统 SHALL 从该分类推荐最多4件商品
4. WHEN 某个分类的可推荐商品不足2件 THEN 推荐系统 SHALL 返回该分类所有可用商品
5. WHEN 推荐商品总数不足4件 THEN 推荐系统 SHALL 返回所有可用的推荐商品

### 需求 3

**用户故事：** 作为一个用户，我希望推荐的商品是我未浏览过的，以便发现新的商品。

#### 验收标准

1. WHEN 推荐系统查询推荐商品 THEN 推荐系统 SHALL 排除用户已浏览过的所有商品
2. WHEN 推荐系统查询推荐商品 THEN 推荐系统 SHALL 仅包含状态为"ForSale"的商品
3. WHEN 推荐系统查询推荐商品 THEN 推荐系统 SHALL 按商品创建时间倒序排列结果

### 需求 4

**用户故事：** 作为系统开发者，我希望推荐算法能够正确处理边界情况，以便系统稳定可靠。

#### 验收标准

1. WHEN 用户浏览的所有商品属于同一分类 THEN 推荐系统 SHALL 仅基于该分类推荐商品
2. WHEN 某个分类下没有可推荐的商品 THEN 推荐系统 SHALL 跳过该分类
3. WHEN 用户浏览记录中的商品已被删除或下架 THEN 推荐系统 SHALL 忽略这些无效记录
4. WHEN 推荐系统处理浏览记录 THEN 推荐系统 SHALL 按浏览时间倒序处理记录
5. WHEN 推荐系统遇到数据库错误 THEN 推荐系统 SHALL 返回适当的错误信息

### 需求 5

**用户故事：** 作为系统维护者，我希望新的推荐算法能够无缝替换旧算法，以便平滑升级系统。

#### 验收标准

1. WHEN 推荐服务被调用 THEN 推荐系统 SHALL 使用新的基于分类的推荐算法
2. WHEN 推荐服务返回结果 THEN 推荐系统 SHALL 保持与现有API接口的兼容性
3. WHEN 首页数据被请求 THEN 推荐系统 SHALL 继续支持推荐商品不足时用最新商品补充的逻辑
4. WHEN 推荐系统计算推荐 THEN 推荐系统 SHALL 不再使用标签信息
