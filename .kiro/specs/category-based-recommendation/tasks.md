# 实施计划

- [ ] 1. 重构 calculateRecommendations 方法实现基于分类的推荐算法
  - 修改 `backend/service/recommend/service.go` 中的 `calculateRecommendations` 方法
  - 实现新的推荐逻辑：获取浏览记录 → 提取分类 → 选择最新的两个不同分类 → 查询推荐商品
  - 确保方法签名保持不变以维持API兼容性
  - _需求: 1.1, 1.2, 1.3, 1.5, 2.1, 2.2, 2.3, 3.1, 3.2, 3.3, 4.4_

- [ ]* 1.1 编写属性测试：分类选择正确性
  - **属性 1: 分类选择正确性**
  - **验证需求: 1.2**

- [ ]* 1.2 编写属性测试：推荐数量上限
  - **属性 2: 推荐数量上限**
  - **验证需求: 2.1**

- [ ]* 1.3 编写属性测试：双分类均衡推荐
  - **属性 3: 双分类均衡推荐**
  - **验证需求: 2.2**

- [ ]* 1.4 编写属性测试：单分类推荐数量
  - **属性 4: 单分类推荐数量**
  - **验证需求: 2.3, 4.1**

- [ ]* 1.5 编写属性测试：排除自己的商品
  - **属性 5: 排除自己的商品**
  - **验证需求: 1.5**

- [ ]* 1.6 编写属性测试：排除已浏览商品
  - **属性 6: 排除已浏览商品**
  - **验证需求: 3.1**

- [ ]* 1.7 编写属性测试：仅推荐在售商品
  - **属性 7: 仅推荐在售商品**
  - **验证需求: 3.2**

- [ ]* 1.8 编写属性测试：商品时间排序
  - **属性 8: 商品时间排序**
  - **验证需求: 3.3**

- [ ]* 1.9 编写属性测试：浏览记录处理顺序
  - **属性 9: 浏览记录处理顺序**
  - **验证需求: 4.4**

- [ ]* 1.10 编写属性测试：API响应格式兼容性
  - **属性 10: API响应格式兼容性**
  - **验证需求: 5.2**

- [ ]* 1.11 编写属性测试：推荐不足时的补充逻辑
  - **属性 11: 推荐不足时的补充逻辑**
  - **验证需求: 5.3**

- [ ] 2. 添加边界情况处理和单元测试
  - 处理空浏览记录场景（返回空列表）
  - 处理单一分类场景
  - 处理商品数量不足场景
  - 处理无效浏览记录（商品已删除或下架）
  - _需求: 1.4, 2.4, 2.5, 4.2, 4.3_

- [ ]* 2.1 编写单元测试：空浏览记录
  - 测试用户没有浏览记录时返回空列表
  - _需求: 1.4_

- [ ]* 2.2 编写单元测试：单一分类
  - 测试用户只浏览了一个分类的商品
  - _需求: 1.3, 4.1_

- [ ]* 2.3 编写单元测试：商品不足
  - 测试某个分类的可推荐商品不足2件
  - 测试推荐商品总数不足4件
  - _需求: 2.4, 2.5_

- [ ]* 2.4 编写单元测试：空分类和无效记录
  - 测试某个分类下没有可推荐的商品
  - 测试浏览记录中的商品已被删除或下架
  - _需求: 4.2, 4.3_

- [ ] 3. 实现错误处理
  - 添加数据库查询失败的错误处理
  - 添加无效参数的处理（userID、maxCount）
  - 确保错误正确传播到Controller层
  - _需求: 4.5_

- [ ]* 3.1 编写单元测试：错误处理
  - 测试数据库错误的处理
  - 测试无效参数的处理
  - _需求: 4.5_

- [ ] 4. 验证API兼容性
  - 运行现有的API测试确保兼容性
  - 验证GetHomeData方法的补充逻辑仍然正常工作
  - 测试Controller层的响应格式
  - _需求: 5.2, 5.3_

- [ ]* 4.1 编写集成测试：完整推荐流程
  - 测试从浏览记录到推荐结果的完整流程
  - 测试API端点的正确性
  - _需求: 5.1, 5.2, 5.3_

- [ ] 5. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [ ] 6. 性能验证和优化
  - 验证数据库查询使用了正确的索引
  - 检查查询性能是否优于旧算法
  - 添加必要的日志记录
  - _需求: 所有需求_

- [ ]* 6.1 编写性能测试
  - 对比新旧算法的性能
  - 验证查询效率

- [ ] 7. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户
